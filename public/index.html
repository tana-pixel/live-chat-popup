<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Live Chat</title>
<link rel="stylesheet" href="style.css">
<script src="/socket.io/socket.io.js"></script>
</head>
<body>

<button id="chatButton">ğŸ’¬ Chat</button>

<div id="chatBox">
  <div id="chatHeader">Live Chat</div>

  <!-- à¸Šà¹ˆà¸­à¸‡à¹ƒà¸ªà¹ˆà¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰ -->
  <div id="usernameBox">
    <input type="text" id="username" placeholder="à¸à¸´à¸¡à¸à¹Œà¸Šà¸·à¹ˆà¸­à¸‚à¸­à¸‡à¸„à¸¸à¸“..." />
  </div>

  <div id="chatMessages"></div>

  <div id="chatInput">
    <input type="text" id="message" placeholder="à¸à¸´à¸¡à¸à¹Œà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡..." />
    
    <!-- à¸›à¸¸à¹ˆà¸¡ emoji -->
    <button id="emojiBtn">ğŸ˜Š</button>

    <!-- à¸›à¸¸à¹ˆà¸¡à¹à¸™à¸šà¹„à¸Ÿà¸¥à¹Œ -->
    <input type="file" id="fileInput" style="display:none;" />
    <button id="fileBtn">ğŸ“</button>

    <!-- à¸›à¸¸à¹ˆà¸¡à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ -->
    <button id="sendBtn">à¸ªà¹ˆà¸‡</button>
  </div>
</div>

<script>
const socket = io();
const chatButton = document.getElementById('chatButton');
const chatBox = document.getElementById('chatBox');
const chatHeader = document.getElementById('chatHeader');
const chatMessages = document.getElementById('chatMessages');
const sendBtn = document.getElementById('sendBtn');
const messageInput = document.getElementById('message');
const usernameInput = document.getElementById('username');
const emojiBtn = document.getElementById('emojiBtn');
const fileBtn = document.getElementById('fileBtn');
const fileInput = document.getElementById('fileInput');

let myUsername = "";

// à¹€à¸ªà¸µà¸¢à¸‡à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™
const notificationSound = new Audio('notification.mp3');

// à¹€à¸›à¸´à¸”/à¸›à¸´à¸” chat
chatButton.addEventListener('click', () => {
  chatBox.style.display = chatBox.style.display === 'flex' ? 'none' : 'flex';
  chatBox.style.flexDirection = 'column';
});

chatHeader.addEventListener('click', () => {
  chatBox.style.display = 'none';
});

// à¸ªà¹ˆà¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡
function sendMessage() {
  const msg = messageInput.value.trim();
  if(!myUsername) {
    myUsername = usernameInput.value.trim() || "à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸";
  }
  if(msg){
    const timestamp = new Date().toLocaleTimeString();
    socket.emit('chat message', { username: myUsername, msg, timestamp });
    messageInput.value = '';
  }
}

// à¸à¸”à¸›à¸¸à¹ˆà¸¡à¸ªà¹ˆà¸‡
sendBtn.addEventListener('click', sendMessage);

// à¸à¸” Enter à¹€à¸à¸·à¹ˆà¸­à¸ªà¹ˆà¸‡
messageInput.addEventListener('keypress', (e) => {
  if(e.key === 'Enter') sendMessage();
});

// emoji à¹à¸šà¸šà¸‡à¹ˆà¸²à¸¢
emojiBtn.addEventListener('click', () => {
  const emoji = prompt("à¸à¸´à¸¡à¸à¹Œ emoji à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£:");
  if(emoji){
    messageInput.value += emoji;
    messageInput.focus();
  }
});

// à¸ªà¹ˆà¸‡à¹„à¸Ÿà¸¥à¹Œà¸£à¸¹à¸›
fileBtn.addEventListener('click', () => fileInput.click());
fileInput.addEventListener('change', () => {
  const file = fileInput.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = function(e){
      const timestamp = new Date().toLocaleTimeString();
      socket.emit('chat message', {
        username: myUsername,
        msg: `<img src="${e.target.result}" style="max-width:150px; max-height:150px;"/>`,
        timestamp
      });
    }
    reader.readAsDataURL(file);
  }
});

// à¸£à¸±à¸šà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡
socket.on('chat message', (data) => {
  const msgDiv = document.createElement('div');
  msgDiv.classList.add('message');

  if(data.username === myUsername){
    msgDiv.classList.add('self');
  } else {
    msgDiv.classList.add('other');
    notificationSound.play(); // à¹€à¸¥à¹ˆà¸™à¹€à¸ªà¸µà¸¢à¸‡à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™
  }

  msgDiv.innerHTML = `
    <div class="msgInfo"><strong>${data.username}</strong> <span>${data.timestamp}</span></div>
    <div class="msgText">${data.msg}</div>
  `;
  chatMessages.appendChild(msgDiv);
  chatMessages.scrollTop = chatMessages.scrollHeight;
});
</script>

</body>
</html>
